<div class="admin-courses-page">
  <div class="admin-header">
    <h1>Course Management</h1>
    <p class="admin-subtitle">Manage and organize all courses</p>
    <%= link_to new_course_path, class: "btn-create" do %>
      <span class="btn-icon">+</span>
      ‡§®‡•Ç‡§§‡§®‡§É courseH ‡§Ø‡•ã‡§ú‡§Ø‡§§‡•Å
    <% end %>
  </div>

  <div class="admin-courses-container">
    <% @courses.each do |course| %>
      <div class="admin-course-card">
        <div class="admin-course-image">
          <%= image_tag rails_blob_url(course.image), alt: course.name %>
        </div>

        <div class="admin-course-content">
          <h2 class="admin-course-title"><%= course.name %></h2>

          <div class="admin-course-info">
            <p><%= truncate(strip_tags(course.description), length: 100) %></p>
            <p><strong>Course code:</strong> <%= course.cname %></p>
            <p><strong>Registration:</strong> 
              <span style="color: <%= course.regon == 'on' ? '#52c41a' : '#ff4d4f' %>;">
                <%= course.regon.upcase %>
              </span>
            </p>

            <details style="margin-top: 1rem;">
              <summary style="cursor: pointer; font-weight: 600; color: #47596F; padding: 0.5rem 0;">
                üìã View Full Details
              </summary>
              <div style="margin-top: 1rem; padding: 1rem; background: #f8f9ff; border-radius: 6px; font-size: 0.9rem;">
                <%= course.more.html_safe %>
                
                <div style="margin-top: 1rem;">
                  <strong>Lecture Links:</strong>
                  <% if course.yt.present? %>
                    <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                      <% course.yt.split("\n").first(3).each do |link| %>
                        <% lecture = link.split(": ") %>
                        <li style="margin-bottom: 0.3rem;">
                          <%= lecture[0] %>: <%= truncate(lecture[1], length: 30) %>
                        </li>
                      <% end %>
                      <% if course.yt.split("\n").length > 3 %>
                        <li style="color: #5a6c7d;">... and <%= course.yt.split("\n").length - 3 %> more</li>
                      <% end %>
                    </ul>
                  <% else %>
                    <p style="margin: 0.5rem 0 0; color: #5a6c7d;">Coming soon</p>
                  <% end %>
                </div>

                <div style="margin-top: 1rem;">
                  <strong>Exams:</strong>
                  <ul style="margin: 0.5rem 0 0 1.5rem; padding: 0;">
                    <% exam_count = 0 %>
                    <% @exams.each do |exam| %>
                      <% if exam.name.include?(course.cname) %>
                        <% exam_parts = exam.name.split("_") %>
                        <% type = exam.etype ? "Quiz" : "Exam" %>
                        <li style="margin-bottom: 0.3rem;">
                          <%= link_to ques_read_path(course.cname, exam_parts[0] + "_" + exam_parts[1]),
                                      style: "color: #47596F; text-decoration: none;" do %>
                            <%= "#{type} - #{exam_parts[1]}" %>
                          <% end %>
                        </li>
                        <% exam_count += 1 %>
                        <% break if exam_count >= 3 %>
                      <% end %>
                    <% end %>
                    <% if exam_count == 0 %>
                      <li style="color: #5a6c7d;">No exams yet</li>
                    <% end %>
                  </ul>
                </div>

                <%= link_to exam_new_path(course.cname), 
                            class: "btn-edit", 
                            style: "margin-top: 1rem; width: 100%; font-size: 0.75rem; height: 36px;" do %>
                  <span class="btn-icon">+</span>
                  Add Exam
                <% end %>
              </div>
            </details>
          </div>

          <div class="admin-course-actions" style="margin-top: 1.5rem;">
            <%= link_to mp_marks_path(course.cname), class: "btn-edit" do %>
              <span class="btn-icon">üìä</span>
              Marks
            <% end %>

            <%= link_to course_path(course.id), class: "btn-edit" do %>
              <span class="btn-icon">‚úèÔ∏è</span>
              Edit
            <% end %>
          </div>

          <div class="admin-course-actions">
            <%= button_to course_delete_path(course.id), 
                        method: "delete", 
                        data: { confirm: "Are you sure you want to delete this course?" },
                        class: "btn-delete" do %>
              <span class="btn-icon">üóëÔ∏è</span>
              ‡§µ‡§ø‡§®‡§∂‡•ç‡§Ø‡§§‡•Å
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
