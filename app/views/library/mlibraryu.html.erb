<div class="form-page">
  <div class="form-container">
    <div class="form-header">
      <div class="greeting">‡§®‡§Æ‡§∏‡•ç‡§§‡•á üôè</div>
      <h1>‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§Ç ‡§™‡§∞‡§ø‡§µ‡§∞‡•ç‡§§‡§Ø‡§§‡•Å</h1>
      <p class="form-subtitle">‡§™‡•Å‡§∏‡•ç‡§§‡§ï‡§∏‡•ç‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£‡§Ç ‡§®‡§µ‡•Ä‡§ï‡§∞‡•ã‡§§‡•Å</p>
    </div>

    <%= form_for @library, url: library_update_path, html: { multipart: true, class: "modern-form" } do |f| %>
      <div class="form-row">
        <div class="form-group">
          <%= f.label :bookid, "Unique ID", class: "form-label" %>
          <%= f.text_field :bookid, required: true, class: "form-input" %>
        </div>

        <div class="form-group">
          <%= f.label :serialno, "‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï‡§Ç (Serial No)", class: "form-label" %>
          <%= f.text_field :serialno, required: true, class: "form-input" %>
        </div>
      </div>

      <div class="form-row">
      <div class="form-group">
          <%= f.label :name, "‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï‡§Ç (Title)", class: "form-label" %>
          <%= f.text_field :name, required: true, class: "form-input" %>
        </div>
        <div class="form-group">
          <%= f.label :author, "‡§∞‡§ö‡§Ø‡§ø‡§§‡•É (Author)", class: "form-label" %>
          <%= f.text_field :author, required: true, class: "form-input" %>
        </div>

      </div>

      <div class="form-row">
        <div class="form-group">
          <%= f.label :primary_genre, "‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï ‡§µ‡§∞‡•ç‡§ó‡§É (Primary Genre)", class: "form-label" %>
          <%= f.text_field :primary_genre, required: true, class: "form-input" %>
        </div>

        <div class="form-group">
          <%= f.label :secondary_genre, "‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø‡§ï ‡§µ‡§∞‡•ç‡§ó‡§É (Secondary Genre)", class: "form-label" %>
          <%= f.text_field :secondary_genre, class: "form-input"%>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <%= f.label :content_language, "‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§≠‡§æ‡§∑‡§æ (Content Language)", class: "form-label" %>
          <%= f.select :content_language, 
              options_for_select([
                ['‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§Æ‡•ç (Sanskrit)', '‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§Æ‡•ç'],
                ['‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)', '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä'],
                ['English', 'English'],
                ['‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§-‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Sanskrit-Hindi)', '‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§-‡§π‡§ø‡§®‡•ç‡§¶‡•Ä'],
                ['‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§-English', '‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§-English'],
                ['‡§Ö‡§®‡•ç‡§Ø‡§§‡•ç (Other)', '‡§Ö‡§®‡•ç‡§Ø‡§§‡•ç']
              ], @library.content_language),
              { prompt: '‡§≠‡§æ‡§∑‡§æ‡§Ç ‡§ö‡§ø‡§®‡•ã‡§§‡•Å...' },
              { required: true, class: "form-input" } 
          %>
        </div>

        <div class="form-group">
          <%= f.label :copies, "‡§ï‡•Å‡§≤ ‡§™‡•ç‡§∞‡§§‡§Ø‡§É (Total Copies)", class: "form-label" %>
          <%= f.number_field :copies, required: true, class: "form-input", min: 0 %>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <%= f.label :present, "‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§™‡•ç‡§∞‡§§‡§Ø‡§É (Present Copies)", class: "form-label" %>
          <%= f.number_field :present, required: true, class: "form-input", min: 0 %>
        </div>

        <div class="form-group">
          <%= f.label :almirah, "‡§Ö‡§≤‡§Æ‡§æ‡§∞‡•Ä (Almirah)", class: "form-label" %>
          <%= f.text_field :almirah, required: true, class: "form-input" %>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <%= f.label :rack, "‡§∞‡•à‡§ï (Rack)", class: "form-label" %>
          <%= f.text_field :rack, required: true, class: "form-input" %>
        </div>

        <div class="form-group">
          <%= f.label :location_in_rack, "‡§∞‡•à‡§ï-‡§∏‡•ç‡§•‡§æ‡§®‡§Æ‡•ç (Location in Rack)", class: "form-label" %>
          <%= f.text_field :location_in_rack, class: "form-input" %>
        </div>
      </div>

      <div class="form-group">
        <%= f.label :link, "‡§™‡•Å‡§∏‡•ç‡§§‡§ï ‡§ö‡§ø‡§§‡•ç‡§∞‡§Æ‡•ç (Book Image)", class: "form-label" %>
        
        <% if @library.link.attached? %>
          <div class="current-image">
            <%= image_tag @library.link, alt: @library.name, style: "max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1);" %>
            <p style="color: #5a6c7d; font-size: 0.9rem; margin-top: 0.5rem;">‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§®‡§Ç ‡§ö‡§ø‡§§‡•ç‡§∞‡§Æ‡•ç</p>
          </div>
        <% end %>

        <div class="file-input-wrapper">
          <%= f.file_field :link, class: "file-input", id: "library-image-input", accept: "image/*" %>
          <label for="library-image-input" class="file-input-label">
            <i class="upload-icon">üìÅ</i>
            <span id="image-file-name">‡§®‡§µ‡•Ä‡§®‡§Ç ‡§ö‡§ø‡§§‡•ç‡§∞‡§Ç ‡§ö‡§ø‡§®‡•ã‡§§‡•Å (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï‡§Æ‡•ç)</span>
          </label>
        </div>
        <div id="library-edit-image-preview" class="file-preview"></div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <%= f.label :added_by, "‡§Ø‡•ã‡§ú‡§ø‡§§‡§É (Added By)", class: "form-label" %>
          <%= f.text_field :added_by, required: true, class: "form-input", readonly: true %>
        </div>

        <div class="form-group">
          <%= f.label :issued_to, "‡§ã‡§£‡§Ç ‡§¶‡§§‡•ç‡§§‡§É (Issued To)", class: "form-label" %>
          <%= f.text_field :issued_to, class: "form-input" %>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <%= f.label :doi, "‡§ã‡§£‡§∏‡•ç‡§Ø ‡§¶‡§ø‡§®‡§æ‡§ô‡•ç‡§ï‡§É (Date of Issue)", class: "form-label" %>
          <%= f.date_field :doi, class: "form-input" %>
        </div>

        <div class="form-group">
          <%= f.label :dor, "‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§∞‡•ç‡§™‡§£‡§∏‡•ç‡§Ø ‡§¶‡§ø‡§®‡§æ‡§ô‡•ç‡§ï‡§É (Date of Return)", class: "form-label" %>
          <%= f.date_field :dor, class: "form-input" %>
        </div>
      </div>

      <div class="form-actions">
        <%= f.submit "‡§®‡§µ‡•Ä‡§ï‡§∞‡•ã‡§§‡•Å", class: "btn btn-primary" %>
        <%= link_to "‡§™‡•ç‡§∞‡§§‡§ø‡§ó‡§ö‡•ç‡§õ‡§§‡•Å", all_librarys_path, class: "btn btn-secondary" %>
      </div>
    <% end %>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const fileInput = document.getElementById('library-edit-image-input');
  const fileNameDisplay = document.getElementById('library-edit-image-file-name');
  const previewContainer = document.getElementById('library-edit-image-preview');
  const currentImage = document.getElementById('current-library-image');

  if (fileInput) {
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      
      if (file) {
        // Update file name
        fileNameDisplay.textContent = file.name;
        
        // Hide current image
        if (currentImage) {
          currentImage.style.display = 'none';
        }
        
        // Create preview
        const reader = new FileReader();
        reader.onload = function(e) {
          previewContainer.innerHTML = `
            <div style="position: relative; display: inline-block;">
              <img src="${e.target.result}" alt="Preview" style="max-width: 300px; max-height: 300px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
              <button type="button" id="remove-library-edit-image" style="position: absolute; top: -10px; right: -10px; background: #ff6b6b; color: white; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-size: 18px; line-height: 1; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">√ó</button>
            </div>
          `;
          
          // Add remove functionality
          document.getElementById('remove-library-edit-image').addEventListener('click', function() {
            fileInput.value = '';
            fileNameDisplay.textContent = '‡§®‡§µ‡•Ä‡§®‡§Ç ‡§ö‡§ø‡§§‡•ç‡§∞‡§Ç ‡§ö‡§ø‡§®‡•ã‡§§‡•Å (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï‡§Æ‡•ç)';
            previewContainer.innerHTML = '';
            if (currentImage) {
              currentImage.style.display = 'block';
            }
          });
        };
        reader.readAsDataURL(file);
      }
    });
  }
});
</script>