<div class="library-page">
  <div class="library-header">
    <div class="header-content">
      <div class="header-text">
        <h1>ЁЯУЪ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдкреНрд░рдмрдиреНрдзрдирдореН</h1>
        <p class="subtitle">рд╕рд░реНрд╡рд╛рдгрд┐ рдкреБрд╕реНрддрдХрд╛рдирд┐ рдкрд╢реНрдпрддреБ рддрдерд╛ рдЪ рдкреНрд░рдмрдиреНрдзрдпрддреБ</p>
      </div>
      <%= link_to new_library_path, class: "btn-add-new" do %>
        <span class="icon">тЮХ</span>
        <span>рдиреВрддрдирдВ рдкреБрд╕реНрддрдХрдВ рдпреЛрдЬрдпрддреБ</span>
      <% end %>
    </div>
  </div>

  <% if @libraries.empty? %>
    <div class="empty-state-container">
      <div class="empty-state">
        <div class="empty-icon">ЁЯУЪ</div>
        <h2>рдЕрдзреБрдирд╛ рдкреБрд╕реНрддрдХрд╛рдирд┐ рди рд╕рдиреНрддрд┐</h2>
        <p>рдкреНрд░рдердордВ рдкреБрд╕реНрддрдХрдВ рдпреЛрдЬрдпрддреБ!</p>
        <%= link_to new_library_path, class: "btn-primary-large" do %>
          <span>тЮХ</span> рдиреВрддрдирдВ рдкреБрд╕реНрддрдХрдВ рдпреЛрдЬрдпрддреБ
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="library-stats">
      <div class="stat-card">
        <div class="stat-icon">ЁЯУЦ</div>
        <div class="stat-info">
          <h3><%= @libraries.count %></h3>
          <p>рдХреБрд▓ рдкреБрд╕реНрддрдХрд╛рдирд┐</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">тЬЕ</div>
        <div class="stat-info">
          <h3><%= @libraries.sum(:present) %></h3>
          <p>рдЙрдкрд▓рдмреНрдзрд╛рдирд┐</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ЁЯУд</div>
        <div class="stat-info">
          <h3><%= @libraries.where.not(issued_to: [nil, ""]).count %></h3>
          <p>рдЛрдгрдВ рджрддреНрддрд╛рдирд┐</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ЁЯП╖я╕П</div>
        <div class="stat-info">
          <h3><%= @libraries.pluck(:primary_genre).uniq.count %></h3>
          <p>рд╡рд░реНрдЧрд╛рдГ</p>
        </div>
      </div>
    </div>

    <div class="search-filter-bar">
      <div class="search-box">
        <span class="search-icon">ЁЯФН</span>
        <input type="text" id="searchInput" placeholder="рдкреБрд╕реНрддрдХрдВ рдЕрдиреНрд╡реЗрд╖рдпрддреБ..." class="search-input">
      </div>
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">рд╕рд░реНрд╡реЗ</button>
        <button class="filter-btn" data-filter="available">рдЙрдкрд▓рдмреНрдзрд╛рдГ</button>
        <button class="filter-btn" data-filter="issued">рдЛрдгрдВ рджрддреНрддрд╛рдГ</button>
      </div>
    </div>

    <div class="books-grid">
      <% @libraries.each_with_index do |library, index| %>
        <div class="book-card" data-status="<%= library.present.to_i > 0 ? 'available' : 'unavailable' %>" data-issued="<%= library.issued_to.present? ? 'yes' : 'no' %>">
          <div class="book-image">
            <% if library.link.attached? %>
              <%= image_tag library.link, alt: library.name, class: "book-cover" %>
            <% else %>
              <div class="book-cover-placeholder">
                <span class="placeholder-icon">ЁЯУЦ</span>
              </div>
            <% end %>
            <div class="book-badge">
              <% if library.present.to_i > 0 %>
                <span class="badge badge-success">рдЙрдкрд▓рдмреНрдзрдореН</span>
              <% else %>
                <span class="badge badge-danger">рдЕрдиреБрдкрд▓рдмреНрдзрдореН</span>
              <% end %>
            </div>
          </div>

          <div class="book-content">
            <div class="book-header">
              <h3 class="book-title"><%= library.name %></h3>
              <p class="book-author">рд░рдЪрдпрд┐рддреГ: <%= library.author %></p>
            </div>

            <div class="book-meta">
              <div class="meta-item">
                <span class="meta-label">ID:</span>
                <span class="meta-value"><%= library.bookid %></span>
              </div>
              <div class="meta-item">
                <span class="meta-label">рд╡рд░реНрдЧрдГ:</span>
                <span class="genre-tag"><%= library.primary_genre %></span>
              </div>
              <div class="meta-item">
                <span class="meta-label">рднрд╛рд╖рд╛:</span>
                <span class="meta-value"><%= library.content_language %></span>
              </div>
            </div>

            <div class="book-details">
              <div class="detail-row">
                <span class="detail-icon">ЁЯУЪ</span>
                <span class="detail-text">рдХреБрд▓: <strong><%= library.copies %></strong> | рд╡рд░реНрддрдорд╛рди: <strong><%= library.present %></strong></span>
              </div>
              <div class="detail-row">
                <span class="detail-icon">ЁЯУН</span>
                <span class="detail-text"><%= library.almirah %> - <%= library.rack %></span>
              </div>
              <% if library.issued_to.present? %>
                <div class="detail-row issued">
                  <span class="detail-icon">ЁЯСд</span>
                  <span class="detail-text">рдЛрдгрдВ рджрддреНрддрдГ: <strong><%= library.issued_to %></strong></span>
                </div>
              <% end %>
            </div>

            <div class="book-actions">
              <%= link_to library_path(library), class: "btn-action btn-edit" do %>
                <span>тЬПя╕П</span> рд╕рдореНрдкрд╛рджрдпрддреБ
              <% end %>
              <%= button_to library_delete_path(library), method: :delete, 
                  data: { confirm: "рдХрд┐рдВ рдирд┐рд╢реНрдЪрд┐рддрдВ рдкреБрд╕реНрддрдХрдВ рдирд╛рд╢рдпрд┐рддреБрдореН рдЗрдЪреНрдЫрддрд┐?" }, 
                  class: "btn-action btn-delete" do %>
                <span>ЁЯЧСя╕П</span> рдирд╛рд╢рдпрддреБ
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('searchInput');
  const filterButtons = document.querySelectorAll('.filter-btn');
  const bookCards = document.querySelectorAll('.book-card');

  if (searchInput) {
    searchInput.addEventListener('input', function() {
      const searchTerm = this.value.toLowerCase();
      filterBooks(searchTerm);
    });
  }

  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      filterButtons.forEach(btn => btn.classList.remove('active'));
      this.classList.add('active');
      
      const filter = this.dataset.filter;
      bookCards.forEach(card => {
        const status = card.dataset.status;
        const issued = card.dataset.issued;
        
        if (filter === 'all') {
          card.style.display = 'flex';
        } else if (filter === 'available') {
          card.style.display = status === 'available' ? 'flex' : 'none';
        } else if (filter === 'issued') {
          card.style.display = issued === 'yes' ? 'flex' : 'none';
        }
      });
    });
  });

  function filterBooks(searchTerm) {
    bookCards.forEach(card => {
      const text = card.textContent.toLowerCase();
      card.style.display = text.includes(searchTerm) ? 'flex' : 'none';
    });
  }
});
</script>